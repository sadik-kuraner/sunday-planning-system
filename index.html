<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Weekplanning Overzicht</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <h1>Weekplanning Overzicht</h1>
  <p class="subtitle">Kies welk formulier je wil invullen of bekijk eerdere weken.</p>
  <div class="cards-row">
    <div class="card">
      <div class="card-header-line">
        <span class="card-icon">ðŸ“…</span>
        <span>Sunday Planning System</span>
      </div>
      <p class="card-text">Plan je week met missie, doelen en afleiders.</p>
      <div class="button-row">
        <a href="sunday.html" class="btn btn-primary">Start Planning</a>
      </div>
    </div>
    <div class="card">
      <div class="card-header-line">
        <span class="card-icon">ðŸ“Š</span>
        <span>Weekly Rhythm Register</span>
      </div>
      <p class="card-text">Track dagelijkse gedragingen en acties.</p>
      <div class="button-row">
        <a href="rhythm.html" class="btn btn-primary">Start Tracking</a>
      </div>
    </div>
  </div>
  <h2 class="section-title-row">Opgeslagen Sunday Plannings</h2>
  <div id="planning-list" class="saved-list"></div>
  <h2 class="section-title-row">Opgeslagen Rhythm Registers</h2>
  <div id="rhythm-list" class="saved-list"></div>
</div>
<script>
function shorten(t, m) { return t.length <= m ? t : t.slice(0, m) + "â€¦"; }
function formatDate(d) {
  if (!d) return "";
  const date = new Date(d);
  const dd = String(date.getDate()).padStart(2, "0");
  const mm = String(date.getMonth() + 1).padStart(2, "0");
  const yyyy = date.getFullYear();
  return `${dd}-${mm}-${yyyy}`;
}

function formatRange(a, b) {
  return a && b ? `Week ${formatDate(a)} â€“ ${formatDate(b)}` : "";
}

function loadPlans() { return JSON.parse(localStorage.getItem("sunday_plans") || "[]"); }
function loadRhythms() { return JSON.parse(localStorage.getItem("rhythms") || "[]"); }
function renderPlannings() {
  const list = document.getElementById("planning-list");
  list.innerHTML = "";
  const items = loadPlans().sort((a,b) => b.created - a.created);
  items.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="saved-card-title">${formatRange(p.from, p.to)}</div>
      <div class="saved-card-sub">${new Date(p.created).toLocaleString()}</div>
      <div class="saved-card-body">${shorten(p.mission || "",120)}</div>
      <div class="button-row">
        <a href="sunday.html?id=${p.id}" class="btn btn-secondary">Openen</a>
        <button class="btn btn-ghost" data-id="${p.id}">Verwijderen</button>
      </div>`;
    card.querySelector("button").onclick = () => {
      const updated = loadPlans().filter(x => x.id !== p.id);
      localStorage.setItem("sunday_plans", JSON.stringify(updated));
      renderPlannings();
    };
    list.appendChild(card);
  });
}
function renderRhythms() {
  const list = document.getElementById("rhythm-list");
  list.innerHTML = "";
  const items = loadRhythms().sort((a,b) => b.created - a.created);
  items.forEach(r => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="saved-card-title">${formatRange(r.from, r.to)}</div>
      <div class="saved-card-sub">${r.rows.length} gedragingen â€¢ ${new Date(r.created).toLocaleString()}</div>
      <div class="button-row">
        <a href="rhythm.html?id=${r.id}" class="btn btn-secondary">Openen</a>
        <button class="btn btn-ghost" data-id="${r.id}">Verwijderen</button>
      </div>`;
    card.querySelector("button").onclick = () => {
      const updated = loadRhythms().filter(x => x.id !== r.id);
      localStorage.setItem("rhythms", JSON.stringify(updated));
      renderRhythms();
    };
    list.appendChild(card);
  });
}
renderPlannings();
renderRhythms();
</script>
</body>
</html>
