<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Weekly Rhythm Register</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <div class="back-row">
    <a href="index.html" class="back-link">‚Üê Terug naar overzicht</a>
  </div>

  <h2 class="page-title">Weekly Rhythm Register</h2>

  <p class="quote">
    "The rhythm of daily action aligned with your goals creates the momentum that separates dreamers from high-performers."
  </p>
  <p class="quote-author">DARREN HARDY</p>

  <form id="rhythm-form">
    <input type="hidden" id="rhythm-id">

    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>BEHAVIOR/ACTION</th>
            <th>MON</th><th>TUES</th><th>WEDS</th><th>THURS</th><th>FRI</th><th>SAT</th><th>SUN</th>
            <th>ACHIEVED</th><th>GOAL</th><th>NET</th><th></th>
          </tr>
        </thead>

        <tbody id="rhythm-body"></tbody>

        <tfoot>
          <tr class="total-row">
            <td>TOTAL</td>
            <td></td><td></td><td></td><td></td>
            <td></td><td></td><td></td>
            <td id="total-achieved" class="number-cell">0</td>
            <td id="total-goal" class="number-cell">0</td>
            <td id="total-net" class="number-cell">0</td>
            <td></td>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="button-row" style="margin-top:12px;">
      <button type="button" id="add-row-btn" class="btn btn-secondary">Rij toevoegen</button>
    </div>

    <p class="quote" style="margin-top:24px;">
      Commitment is doing what you said you would do long after the mood you said it in has left you.
    </p>

    <div class="form-grid-two" style="margin-top:24px;">
      <div>
        <label for="rhythm-from">FROM</label>
        <input type="date" id="rhythm-from">
      </div>
      <div>
        <label for="rhythm-to">TO (DATES)</label>
        <input type="date" id="rhythm-to">
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Opslaan</button>
      <button type="button" id="print-btn" class="btn btn-secondary">Printen</button>
    </div>

    <p id="save-status" class="form-note"></p>
  </form>
</div>

<script>
const idEl=document.getElementById("rhythm-id");
const fromEl=document.getElementById("rhythm-from");
const toEl=document.getElementById("rhythm-to");
const bodyEl=document.getElementById("rhythm-body");
const statusEl=document.getElementById("save-status");

function storageLoad(){
  return JSON.parse(localStorage.getItem("rhythms") || "[]");
}

function storageSave(list){
  localStorage.setItem("rhythms", JSON.stringify(list));
}

function rhythmId(from,to){ return `${from}_${to}_rhythm`; }

function createRow(initial={}){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input type="text" class="behavior-input" value="${initial.behavior||""}"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-mon"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-tues"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-weds"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-thurs"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-fri"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-sat"></td>
    <td class="checkbox-cell"><input type="checkbox" class="day-sun"></td>

    <td class="number-cell achieved-cell">0</td>
    <td><input type="number" class="goal-cell" value="${initial.goal||0}" min="0" max="7"></td>
    <td class="number-cell net-cell">0</td>

    <td><button type="button" class="icon-btn delete-row-btn">üóë</button></td>
  `;

  ["mon","tues","weds","thurs","fri","sat","sun"].forEach(d=>{
    if(initial[d]) tr.querySelector(`.day-${d}`).checked=true;
  });

  tr.querySelectorAll("input").forEach(el=>{
    el.addEventListener("input", ()=>{updateRow(tr);updateTotals();});
  });

  tr.querySelector(".delete-row-btn").onclick=()=>{
    tr.remove();
    updateTotals();
  };

  updateRow(tr);
  bodyEl.appendChild(tr);
}

function updateRow(tr){
  const checks=tr.querySelectorAll("input[type='checkbox']");
  let achieved=0;
  checks.forEach(c=>achieved+=c.checked?1:0);

  tr.querySelector(".achieved-cell").textContent=achieved;

  const goal=Number(tr.querySelector(".goal-cell").value||0);
  const net=achieved-goal;

  const netCell=tr.querySelector(".net-cell");
  netCell.textContent=net;
  netCell.classList.toggle("negative",net<0);
}

function updateTotals(){
  let achieved=0,goal=0,net=0;
  bodyEl.querySelectorAll("tr").forEach(tr=>{
    achieved+=Number(tr.querySelector(".achieved-cell").textContent);
    goal+=Number(tr.querySelector(".goal-cell").value);
    net+=Number(tr.querySelector(".net-cell").textContent);
  });

  document.getElementById("total-achieved").textContent=achieved;
  document.getElementById("total-goal").textContent=goal;
  document.getElementById("total-net").textContent=net;
}

function loadExisting(){
  const params=new URLSearchParams(location.search);
  const id=params.get("id");
  if(!id){ createRow(); return; }

  const list=storageLoad();
  const item=list.find(x=>x.id===id);

  if(!item){ createRow(); return; }

  idEl.value=item.id;
  fromEl.value=item.from;
  toEl.value=item.to;

  bodyEl.innerHTML="";
  item.rows.forEach(r=>createRow(r));

  updateTotals();
}

function saveRhythm(){
  const from=fromEl.value;
  const to=toEl.value;

  if(!from||!to){
    alert("Vul FROM en TO in.");
    return;
  }

  const rows=[];
  bodyEl.querySelectorAll("tr").forEach(tr=>{
    const behavior=tr.querySelector(".behavior-input").value.trim();
    if(!behavior) return;

    rows.push({
      behavior,
      mon:tr.querySelector(".day-mon").checked,
      tues:tr.querySelector(".day-tues").checked,
      weds:tr.querySelector(".day-weds").checked,
      thurs:tr.querySelector(".day-thurs").checked,
      fri:tr.querySelector(".day-fri").checked,
      sat:tr.querySelector(".day-sat").checked,
      sun:tr.querySelector(".day-sun").checked,
      goal:Number(tr.querySelector(".goal-cell").value)
    });
  });

  const id=rhythmId(from,to);
  idEl.value=id;

  const list=storageLoad().filter(x=>x.id!==id);
  list.push({
    id,
    from,
    to,
    rows,
    created:Date.now()
  });

  storageSave(list);
  statusEl.textContent="Rhythm opgeslagen.";
}

document.getElementById("add-row-btn").onclick=()=>createRow();
document.getElementById("rhythm-form").onsubmit=e=>{e.preventDefault();saveRhythm();};
document.getElementById("print-btn").onclick=()=>window.print();

loadExisting();
</script>

</body>
</html>
